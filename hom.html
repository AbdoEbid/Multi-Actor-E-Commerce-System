<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!--  new hoooome -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-secondary p-3">
        <div class="container">
            <a class="navbar-brand fw-bold text-light fs-4" href="home.html">
                <i class="bi bi-lightning-fill"></i> Electronics Store
            </a>

            <!-- Toggle Button -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Links -->
            <div class="collapse navbar-collapse" id="mainNavbar">
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    <li class="nav-item px-2">
                        <a class="nav-link active border-bottom border-warning special-hover" href="home.html">HOME</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link text-light special-hover" href="#">ABOUT</a>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link text-light special-hover" href="#">SHOP </span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light special-hover" href="#" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            CATEGORIES
                        </a>
                        <ul class="dropdown-menu bg-secondary">
                            <li><a class="dropdown-item text-light" href="#">Mobiles</a></li>
                            <li><a class="dropdown-item text-light" href="#">Laptops</a></li>
                            <li><a class="dropdown-item text-light" href="#">HeadPhones</a></li>
                            <li><a class="dropdown-item text-light" href="#">Tablets</a></li>
                            <li><a class="dropdown-item text-light" href="#">Accessories</a></li>
                        </ul>
                    </li>
                    <li class="nav-item px-2">
                        <a class="nav-link text-light special-hover" href="#">CONTACT</a>
                    </li>
                </ul>

                <!-- Icons -->
                <div class="d-flex gap-4 fs-5 icons">
                    <a id="Register-Icon" class="text-light"><i class="bi bi-person-circle"></i></a>
                    <a href="#" class="text-light"><i class="bi bi-cart"></i></a>
                    <a href="#" class="text-light heart-toggle"><i class="bi bi-heart"></i></a>
                </div>
            </div>
        </div>
    </nav>

    <div id="registerModal"
        class="d-none position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center">
        <div class="modal-content p-4 bg-white rounded-3 " style="width: 500px;">
            <button class="btn-close position-absolute top-0 end-0 p-2" id="closePopup"></button>
            <div id="signUpForm">
                <h2 class="text-center">Sign Up</h2>
                <form onsubmit="Save(event)">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" placeholder="Name">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="text" class="form-control" id="email" placeholder="Email">
                    </div>
                    <div class="mb-3 position-relative">
                        <label for="password" class="form-label">Password</label>
                        <div class="d-flex">
                            <input type="password" class="form-control" id="password" placeholder="Password">
                            <img src="./eye-icons/eye-close.png" id="eyeIcon" class="position-absolute top-95 end-0"
                                style="cursor: pointer; width: 30px; padding: 12px 5px 5px ;">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="role" class="form-label">Role</label>
                        <select class="form-select" id="role">
                            <option value="customer">Customer</option>
                            <option value="seller">Seller</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-warning w-100">Register</button>
                </form>
                <div class="mb-3 text-center">
                    <p>Already have an account? <a href="#" id="toggleToLogin">Log in</a></p>
                </div>
            </div>

            <div id="loginForm" style="display: none;">
                <h2 class="text-center">Log In</h2>
                <form onsubmit="Login(event)">
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Email</label>
                        <input type="text" class="form-control" id="loginEmail" placeholder="Email">
                    </div>
                    <div class="mb-3 position-relative">
                        <label for="loginPassword" class="form-label">Password</label>
                        <div class="d-flex">
                            <input type="password" class="form-control" id="loginPassword" placeholder="Password">
                            <img src="./eye-icons/eye-close.png" id="loginEyeIcon"
                                class="position-absolute top-95 end-0"
                                style="cursor: pointer; width: 30px; padding: 12px 5px 5px;">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning w-100">Log In</button>
                </form>
                <div class="mb-3 text-center">
                    <p>Don't have an account? <a href="#" id="toggleToSignUp">Sign Up</a></p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import StorageManager from './modules/StorageModule.js'
        import UserManager from './modules/UserModule.js';

        // Show and hide modal
        const modal = document.getElementById("registerModal");
        const icon = document.getElementById("Register-Icon");
        const closeBtn = document.getElementById("closePopup");

        document.getElementById('toggleToLogin').onclick = function () {
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        };

        document.getElementById('toggleToSignUp').onclick = function () {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
        };

        icon.onclick = () => modal.classList.remove('d-none');
        closeBtn.onclick = () => modal.classList.add('d-none');
        window.onclick = (e) => {
            if (e.target === modal) modal.classList.add('d-none');
        }

        // Password eyeIcon
        const eyeIcon = document.getElementById("eyeIcon");
        const password = document.getElementById("password");
        eyeIcon.onclick = () => {
            if (password.type == "password") {
                password.type = "text";
                eyeIcon.src = "./eye-icons/eye-open.png";
            } else {
                password.type = "password";
                eyeIcon.src = "./eye-icons/eye-close.png";
            }
        };

        const loginEyeIcon = document.getElementById("loginEyeIcon");
        const loginPassword = document.getElementById("loginPassword");
        loginEyeIcon.onclick = () => {
            if (loginPassword.type == "password") {
                loginPassword.type = "text";
                loginEyeIcon.src = "./eye-icons/eye-open.png";
            } else {
                loginPassword.type = "password";
                loginEyeIcon.src = "./eye-icons/eye-close.png";
            }
        };

        window.Save = function (event) {
            event.preventDefault();

            let name = document.getElementById('name').value.trim();
            let email = document.getElementById('email').value.trim().toLowerCase();
            let password = document.getElementById("password").value;
            let role = document.getElementById("role").value;

            // Add Static ADMIN in Local Storage in Section Users
            const users = StorageManager.LoadSection("users") || [];
            const adminExists = users.some(user => user.id === 0 && user.role === "admin");

            if (!adminExists) {
                const staticAdmin = {
                    id: 0,
                    name: "Admin User",
                    email: "admin@gmail.com",
                    password: "admin123",
                    role: "admin"
                };
                users.push(staticAdmin);
                StorageManager.SaveSection("users", users);
                console.log("Static admin added.");
            }

            // Add New Users with Incremental IDs
            const newId = UserManager.GenerateNextID();
            UserManager.CreateUser(newId, name, email, password, role);
        }

        window.Login = function (event) {
            event.preventDefault();

            const email = document.getElementById("loginEmail").value.trim().toLowerCase();
            const password = document.getElementById("loginPassword").value;

            const users = StorageManager.LoadSection("users") || [];

            const LoginUser = users.find(user => user.email === email && user.password === password);

            if (LoginUser) {
                // alert(`Welcome back, ${LoginUser.name}! You are logged in as ${LoginUser.role}.`);

                switch (LoginUser.role) {
                    case "customer":
                        window.location.href = "hom.html";
                        break;
                    case "admin":
                        window.location.href = "admin-panel.html";
                        break;
                    case "seller":
                        window.location.href = "seller-dashboard.html";
                        break;
                    default:
                        alert("Invalid role. Please try again.");
                }
            } else {
                alert("Invalid email or password. Please try again.");
            }
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>