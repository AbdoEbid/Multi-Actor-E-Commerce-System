<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignUp</title>
</head>

<body>
    <h1>Sign Up</h1>
    <form action="#" onsubmit="Save(event)">
        <label for="name">Name</label>
        <input type="text" id="name" placeholder="Enter your name"><br><br>
        <label for="email">Email</label>
        <input type="text" id="email" placeholder="Enter your email"><br><br>
        <label for="password">Pass</label>
        <input type="password" id="password" placeholder="Enter your password"><br><br>
        <p>Choose Role</p>
        <select id="role">
            <option value="customer">Customer</option>
            <option value="seller">Seller</option>
        </select><br><br>
        <input type="submit" value="submit">
    </form>

    <script type="module">
        import StorageManager from './modules/base/StorageModule.js';

        window.Save = function (event) {
            event.preventDefault();

            let name, email, password, role;

            name = document.getElementById("name").value;
            email = document.getElementById("email").value;
            password = document.getElementById("password").value;
            role = document.getElementById("role").value;

            //Validations
            if (name == "" || password == "" || email == "") {
                alert("Please Enter Name , Email , Password");
                return false;
            }
            else if (name == "") {
                alert("Please Enter Name");
                return false;
            }
            else if (email == "") {
                alert("Please Enter Email");
                return false;
            }
            else if (password == "") {
                alert("Please Enter Password");
                return false;
            }
            else if (name == "" || password == "" || email == "") {
                alert("Please enter name , email , password");
            }
            else if (!validateName(name)) {
                alert("Name must be at least 3 to maximum 15 characters long and contain only letters");
                return false;
            }
            else if (!validateEmail(email)) {
                alert("Please enter a valid email address like that example@gmail.com");
                return false;
            }
            else if (!validatePass(password)) {
                alert("Password must be at least 8 characters long and contain uppercase or lowercase, a number, and a special character");
                return false;
            }
            else {
                alert("Successfully Registeration!");
            }



            let user = { name, email, password, role };
            let users = StorageManager.LoadSection("users") || [];

            //In our project work with only one Admin Static
            const Admin = {
                "name": "Admin User",
                "email": "admin@gmail.com",
                "password": "admin123",
                "role": "admin",
            };

            //Validation for email
            if (!users.some(u => u.email === Admin.email)) {
                //Push Admin to users Section
                users.push(Admin);
            }

            if (users.some(u => u.email === email)) {
                alert("Email already registered!");
                return;
            }

            //Push user to users Section
            users.push(user);

            //Save Admin and User in localStorage as(Users)
            StorageManager.SaveSection("users", users);
        }

        //Functions For validations
        function validateName(name) {
            return /^[A-Za-z\s]{3,15}$/.test(name);
        }
        function validateEmail(email) {
            return /^[a-zA-Z]+[0-9]*@[a-zA-Z]+\.[a-zA-Z]{2,}$/.test(email);
        }
        function validatePass(password) {
            let passPattern = /^(?=.*[!@#$%^&*])(?=.*\d)(?=.*[a-zA-Z]).{8,}$/;
            return passPattern.test(password);
        }


    </script>
</body>